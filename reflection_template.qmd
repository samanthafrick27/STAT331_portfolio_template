---
title: "STAT 331 Portfolio"
author: "Samantha Frick"
format: html 
embed-resources: true
layout: margin-left
editor: visual
execute: 
  eval: false
  echo: true
---

[**My Grade:**]{.underline} I believe my grade equivalent to course work evidenced below to be an A-.

[**Learning Objective Evidence:**]{.underline} In the code chunks below, provide code from Lab or Challenge assignments where you believe you have demonstrated proficiency with the specified learning target. Be sure to specify **where** the code came from (e.g., Lab 4 Question 2).

## Working with Data

**WD-1: I can import data from a *variety* of formats (e.g., csv, xlsx, txt, etc.).**

-   `csv` Example 1

```{r}
#| label: wd-1-csv-1
# Lab 2 Question 1
surveys <- read_csv(here::here("Week 2", "Lab2", "surveys.csv"))
```

-   `csv` Example 2

```{r}
#| label: wd-1-csv-2
# Challenge 3
evals <- read_csv(here::here("Week 3", "Lab 3", "teacher_evals.csv"))
```

-   `xlsx`

```{r}
#| label: wd-1-xlsx
# Practice Activity 4
military <- read_xlsx("gov_spending_per_capita.xlsx",
                      sheet = "Share of Govt. spending",
                      skip  = 7,
                      n_max = 190,
                      na = c("..", "xxx", ". .")
                      )
```

**WD-2: I can select necessary columns from a dataset.**

-   Example selecting specified columns

```{r}
#| label: wd-2-ex-1
# Lab 3 Question 5 Revised
# Success comment: "Nice use of across!"

teacher_evals_clean <- evals |>
  rename(sex = gender) |>
  filter(no_participants >= 10) |>
  mutate(across(.cols = c(course_id, teacher_id), .fns = ~ as.character(.x)),
         across(.cols = c(question_no, academic_degree, sex), .fns = ~ as.factor(.x)),
         no_participants = as.integer(no_participants)
         ) |>
  select(course_id, teacher_id, question_no, no_participants, resp_share, SET_score_avg, percent_failed_cur, academic_degree, seniority, sex)

```

-   Example removing specified columns

```{r}
#| label: wd-2-ex-2
# Lab 9, Question 6, Revised
# Growing Comment: There is no table being output! 
# I accidentally called sex gender, so the table didn't output.
evals |>
  distinct(teacher_id, .keep_all = TRUE) |>
  mutate(
    academic_degree = fct_recode(
      academic_degree,
      "Doctorate" = "dr",
      "Masters" = "ma",
      "No Degree" = "no_dgr",
      "Tenured Professor" = "prof"
    ),
    sex = fct_recode(
      sex,
      "Male" = "male",
      "Female" = "female"
    ),
    seniority_group = case_when(
      seniority %in% 1:4 ~ "Junior",
      seniority %in% 5:8 ~ "Senior",
      seniority %in% 9:12 ~ "Very Senior"
    ) |>
      factor(levels = c("Junior", "Senior", "Very Senior"))
  ) |>
  select(
    academic_degree,
    seniority = seniority_group,
    sex
  ) |>
  pivot_longer(
    cols = c(academic_degree, seniority, sex),
    names_to = "Variable",
    values_to = "Level"
  ) |>
  mutate(
    Variable = case_when(
      Variable == "academic_degree" ~ "Academic Degree",
      Variable == "seniority" ~ "Seniority",
      Variable == "sex" ~ "Sex"
    )
  ) |>
  count(Variable, Level, name = "Count") |>
  group_by(Variable) |>
  mutate(`%` = Count / sum(Count)) |>
  mutate(`%` = percent(`%`, accuracy = 0.01)) |>
  ungroup() |>
  select(-Variable) |>                                 # removing column here!
  kable() |>
  kable_styling(full_width = FALSE) |>
  pack_rows(index = c("Academic Degree" = 4, "Seniority" = 3, "Sex" = 2),
            start_row = 1,
            label_row_css = "background-color: #afad8f") |>
  add_header_above(c(" " = 1, "Professors" = 2)) |> 
  add_header_above(c("Student Evaluations at the University of Poland--Warsaw in 2020" = 3),
                   font_size = 10) |>
  add_header_above(c("Demographics of Professors" = 3))
```

-   Example selecting columns based on logical values (e.g., `starts_with()`, `ends_with()`, `contains()`, `where()`)

```{r}
#| label: wd-2-ex-3
# Lab 4 Question 7 Revised
# Success comment: Nice work pivoting and modifying the age variable!Nice work reordering your legend and your facets!!!Can you match my colors??? These are coming from a package and you will need to expand the color palette to get all 10 colors.
# I revised this code to use starts_with("mc_") to hit this learning target. 
region_labels <- c(
  san_fran_counties            = "San Francisco Bay Area",
  inland_counties              = "Inland Empire",
  superior_counties            = "Superior California",
  north_coast_counties         = "North Coast",
  central_coast_counties       = "Central Coast",
  n_san_joaquin_counties       = "Northern San Joaquin Valley",
  s_san_joaquin_counties       = "Southern San Joaquin Valley",
  la_county                    = "Los Angeles County",
  orange_county                = "Orange County",
  san_diego_imperial_counties  = "San Diego–Imperial"
)
ca_childcare |>
  pivot_longer(cols = starts_with("mc_"),
             names_to = "age_group", names_prefix = "mc_",
             values_to = "weekly_price") |>
  mutate(age_group = str_to_title(age_group),
  county_region = fct_reorder2(.f = county_region,
                               .x = study_year,
                               .y = weekly_price)) |> 
  ggplot(mapping = aes(x = study_year, y = weekly_price, color = county_region)) +
  geom_point(alpha = 0.8, size = 0.6) +
  geom_smooth(method = "loess", linewidth = 0.5) + 
  facet_wrap(~ age_group) + 
  labs(
    title = "Weekly Median Price for Center-Based Childcare ($)",
    x = "Study Year",
    y = NULL,
    color = "California Region"
  ) + 
    scale_color_manual(
    breaks = names(region_labels),
    labels = region_labels,
    values = colorRampPalette(brewer.pal(8, "Accent"))(10)
  ) +
  scale_x_continuous(breaks = seq(2008, 2018, by = 2)) + 
  scale_y_continuous(limits = c(100, 500)) +
  theme_bw() +
  theme(
    aspect.ratio = 1,
    axis.text = element_text(size = 6),
    plot.title = element_text(size = 10),
    panel.border = element_rect(color = "black", fill = NA)
  )  
```

**WD-3: I can filter rows from a data frame for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-3-numeric-ex-1
# Lab 4 Question 5 Revised
# Growing Comment: Notice that your table still has a grouping variable! Because you grouped by **two** variables, your first group was not dropped! Can you give your column names better titles, so the reader knows what "2008" and "2018" represent? What are the values stored in these columns?
# I added .groups = "drop" to make sure that all grouping is removed. I also added prefixes to the column names to make it clear to the reader what values are in these columns. 

income_by_region <- ca_childcare |>
  filter(study_year %in% c(2008, 2018)) |>
  group_by(county_region, study_year) |>
  summarize(median_income = median(mhi_2018, na.rm = TRUE), .groups = "drop") |>
  pivot_wider(names_from = study_year,
              values_from = median_income,
              names_prefix = "median_income_") |>
  arrange(desc(median_income_2018))

income_by_region
```

-   Numeric Example 2

```{r}
#| label: wd-3-numeric-ex-2
# Lab 3 Question 10 Revised
# Growing Comment: Can you do this in one call to the summarize function? Is there a function that allows you to slice the max of a specific variable? Is there a way you can get the max *and* min in **one** pipeline?
# In office hours we discussed how slice_min and slice_max could be used, but there was an even more efficient way to find the max and min using filter. 

Q10 <- teacher_evals_clean |>
  filter(question_no == 901) |>
  group_by(teacher_id) |> 
  summarize(course_avg = mean(SET_score_avg), n_courses = n_distinct(course_id)) |>
  filter(n_courses > 4) |>
  filter(course_avg == max(course_avg) |
         course_avg == min(course_avg))

#slice_min(Q10, order_by = course_avg)
#slice_max(Q10, order_by = course_avg)

Q10
```

-   Character Example 1 (any context)

```{r}
#| label: wd-3-character
# Lab 4 Question 2 Revised
# Success Comment: Why these FIPS codes? Are these for CA? If so, why not just filter for the state being CA?
# I had originally filtered by CA FIPS codes to filter for the state being CA because I didn't realize that state was a variable. I revised the code to be much simpler to just filter for the state being CA.

ca_childcare <- childcare_costs |>
  filter(state_abbreviation == "CA") |>
  left_join(y = counties, by = join_by(county_fips_code))
  
ca_childcare
```

-   Character Example 2 (example must use functions from **stringr**)

```{r}
#| label: wd-3-string
# Lab 5, Revised
# Growing comment: It looks like you are using values from one dataset to filter another dataset rather than joining two datasets together. The intention of this lab is to practice using joins!
# I filtered through the person dataset and then joined this dataset to the interview dataset. 
# I used join_by instead of by = c()
person |>
  filter(
    (address_street_name == "Northwestern Dr" & 
     address_number == max(address_number)) | 
    (str_detect(name, "Annabel") &
    address_street_name == "Franklin Ave")) |>
  left_join(interview, by = join_by(id == person_id)) |>
  select(transcript)
```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-3-date
# Lab 5, Revised
# Success comment: Technically, the date variable was read in as an integer. Could you convert it into a date-time variable? This would give you the opportunity to demonstrate your ability to work with date variables using the lubridate package (e.g., WD-3 & WD-4).

crime <- crime_scene_report |>
  mutate(date = ymd(date)) |>
  filter(date == ymd("2018-01-15"),        
         type == "murder",
         city == "SQL City")
crime
```

**WD-4: I can modify existing variables and create new variables in a dataframe for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-4-numeric-ex-1
# Challenge 3 Question 1, Revised
# I mutated the question_no variable to remove the "90" from the start of each number.
teacher_evals_compare <- evals |>
  group_by(course_id) |>
  mutate(
    question_no = as.numeric(str_remove(as.character(question_no), "^90")),
    set_level = if_else(SET_score_avg >= 4, "excellent", "standard"),
    sen_level = case_when(
      seniority <= 4 ~ "junior", 
      seniority >=5 & seniority <= 8 ~ "senior",
      seniority > 8 ~ "very senior"
      )
    ) |>
  filter(question_no == 3) |>
  select(course_id, set_level, sen_level)
teacher_evals_compare
```

-   Numeric Example 2

```{r}
#| label: wd-4-numeric-ex-2
# Challenge 3 Question 1, Revised
# I mutated the question_no variable to remove the "90" from the start of each number.
teacher_evals_compare <- evals |>
  group_by(course_id) |>
  mutate(
    question_no = as.numeric(str_remove(as.character(question_no), "^90")),
    set_level = if_else(SET_score_avg >= 4, "excellent", "standard"),
    sen_level = case_when(
      seniority <= 4 ~ "junior", 
      seniority >=5 & seniority <= 8 ~ "senior",
      seniority > 8 ~ "very senior"
      )
    ) |>
  filter(question_no == 3) |>
  select(course_id, set_level, sen_level)
teacher_evals_compare
```

-   Factor Example 1 (renaming levels)

```{r}
#| label: wd-4-factor-ex-1
evals |>
  distinct(teacher_id, .keep_all = TRUE) |>
  mutate(
    academic_degree = fct_recode(
      academic_degree,
      "Doctorate" = "dr",
      "Masters" = "ma",
      "No Degree" = "no_dgr",
      "Tenured Professor" = "prof"
    ),
    sex = fct_recode(
      sex,
      "Male" = "male",
      "Female" = "female"
    ),
    seniority_group = case_when(
      seniority %in% 1:4 ~ "Junior",
      seniority %in% 5:8 ~ "Senior",
      seniority %in% 9:12 ~ "Very Senior"
    ),
    seniority_group = factor(
      seniority_group,
      levels = c("Junior", "Senior", "Very Senior")
    )
  ) |>
  select(
    academic_degree,
    seniority = seniority_group,
    sex
  ) |>
  pivot_longer(
    cols = c(academic_degree, seniority, sex),
    names_to = "Variable",
    values_to = "Level"
  ) |>
  mutate(
    Variable = case_when(
      Variable == "academic_degree" ~ "Academic Degree",
      Variable == "seniority" ~ "Seniority",
      Variable == "sex" ~ "Sex"
    )
  ) |>
  count(Variable, Level) |>
  group_by(Variable) |>
  mutate(prop = n / sum(n)) |>
  ungroup() |>
  kable() |>
  kable_styling(full_width = FALSE, bootstrap_options = "striped")
```

-   Factor Example 2 (reordering levels)

```{r}
#| label: wd-4-factor-ex-2
# Lab 4 Question 7 Revised
# Success comment: Nice work pivoting and modifying the age variable!Nice work reordering your legend and your facets!!!Can you match my colors??? These are coming from a package and you will need to expand the color palette to get all 10 colors.

region_labels <- c(
  san_fran_counties            = "San Francisco Bay Area",
  inland_counties              = "Inland Empire",
  superior_counties            = "Superior California",
  north_coast_counties         = "North Coast",
  central_coast_counties       = "Central Coast",
  n_san_joaquin_counties       = "Northern San Joaquin Valley",
  s_san_joaquin_counties       = "Southern San Joaquin Valley",
  la_county                    = "Los Angeles County",
  orange_county                = "Orange County",
  san_diego_imperial_counties  = "San Diego–Imperial"
)
ca_childcare |>
  pivot_longer(cols = c(mc_infant, mc_toddler, mc_preschool),
             names_to = "age_group", names_prefix = "mc_",
             values_to = "weekly_price") |>
  mutate(age_group = str_to_title(age_group),
  county_region = fct_reorder2(.f = county_region,
                               .x = study_year,
                               .y = weekly_price)) |> 
  ggplot(mapping = aes(x = study_year, y = weekly_price, color = county_region)) +
  geom_point(alpha = 0.8, size = 0.6) +
  geom_smooth(method = "loess", linewidth = 0.5) + 
  facet_wrap(~ age_group) + 
  labs(
    title = "Weekly Median Price for Center-Based Childcare ($)",
    x = "Study Year",
    y = NULL,
    color = "California Region"
  ) + 
    scale_color_manual(
    breaks = names(region_labels),
    labels = region_labels,
    values = colorRampPalette(brewer.pal(8, "Accent"))(10)
  ) +
  scale_x_continuous(breaks = seq(2008, 2018, by = 2)) + 
  scale_y_continuous(limits = c(100, 500)) +
  theme_bw() +
  theme(
    aspect.ratio = 1,
    axis.text = element_text(size = 6),
    plot.title = element_text(size = 10),
    panel.border = element_rect(color = "black", fill = NA)
  )  
```

-   Character (example must use functions from **stringr**)

```{r}
#| label: wd-4-string
# Lab 4 Question 7 Revised
# Success comment: Nice work pivoting and modifying the age variable!Nice work reordering your legend and your facets!!!Can you match my colors??? These are coming from a package and you will need to expand the color palette to get all 10 colors.
# Revised from midterm: I added dollar signs on the y-axis.

region_labels <- c(
  san_fran_counties            = "San Francisco Bay Area",
  inland_counties              = "Inland Empire",
  superior_counties            = "Superior California",
  north_coast_counties         = "North Coast",
  central_coast_counties       = "Central Coast",
  n_san_joaquin_counties       = "Northern San Joaquin Valley",
  s_san_joaquin_counties       = "Southern San Joaquin Valley",
  la_county                    = "Los Angeles County",
  orange_county                = "Orange County",
  san_diego_imperial_counties  = "San Diego–Imperial"
)
ca_childcare |>
  pivot_longer(cols = starts_with("mc_"),
             names_to = "age_group", names_prefix = "mc_",
             values_to = "weekly_price") |>
  mutate(age_group = str_to_title(age_group),  #stringr function for this portfolio checkpoint 
  county_region = fct_reorder2(.f = county_region,
                               .x = study_year,
                               .y = weekly_price)) |> 
  ggplot(mapping = aes(x = study_year, y = weekly_price, color = county_region)) +
  geom_point(alpha = 0.8, size = 0.6) +
  geom_smooth(method = "loess", linewidth = 0.5) + 
  facet_wrap(~ age_group) + 
  labs(
    title = "Weekly Median Price for Center-Based Childcare ($)",
    x = "Study Year",
    y = NULL,
    color = "California Region"
  ) + 
    scale_color_manual(
      breaks = names(region_labels),
      labels = region_labels,
      values = colorRampPalette(brewer.pal(8, "Accent"))(10)
  ) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    ) +
  scale_y_continuous(
    limits = c(100, 500),
    labels = label_currency()
  ) +
  theme_bw() +
  theme(
    aspect.ratio = 1,
    axis.text = element_text(size = 6),
    plot.title = element_text(size = 10),
    panel.border = element_rect(color = "black", fill = NA)
  )  
```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-4-date
# Lab 5, Revised
# Success comment: Technically, the date variable was read in as an integer. Could you convert it into a date-time variable? This would give you the opportunity to demonstrate your ability to work with date variables using the lubridate package (e.g., WD-3 & WD-4).

crime <- crime_scene_report |>
  mutate(date = ymd(date)) |>
  filter(date == ymd("2018-01-15"),        
         type == "murder",
         city == "SQL City")
crime
```

**WD-5: I can use mutating joins to combine multiple dataframes.**

-   `left_join()` Example 1

```{r}
#| label: wd-5-left-ex-1
# Lab 4 Question 3, revised
# Success comment: You already joined the counties dataset! Nice work noticing that there are two keys that need to be used for joining!
# Revised from midterm portfolio: I used the most modern syntax: join_by() instead of c().

ca_childcare <- ca_childcare |>
  left_join(y = tax_rev,
            by = join_by(county_name == entity_name, study_year == year))

ca_childcare

```

-   `right_join()` Example 1

```{r}
#| label: wd-5-right
# Lab 5, Revised
# Revised from midterm portfolio: I used the most modern syntax: join_by() instead of c().
hired <- drivers_license |>
  right_join(person, by = join_by(id == license_id)) |>
  filter(
    gender == "female",
    height >= 65, 
    height <= 67,
    hair_color == "red",
    car_make == "Tesla",
    car_model == "Model S"
  ) |>
  select("id", "height", "hair_color", "gender", "car_make", "car_model", "ssn", "name")
hired
```

-   `left_join()` **or** `right_join()` Example 2

```{r}
#| label: wd-5-left-right-ex-2
# Lab 5
dec_symphony <- facebook_event_checkin |>
  left_join(hired, by = c("person_id" = "id")) |>
  filter(event_name == "SQL Symphony Concert",
         str_starts(date,"201712")) |>
  count(person_id, name = "n_checkins") |>
  filter(n_checkins >= 3) |>
  left_join(person, by = join_by(person_id == id)) |>
  inner_join(hired, by = join_by(name)) |>
  left_join(interview, by = join_by(person_id))
dec_symphony
```

-   `inner_join()` Example 1

```{r}
#| label: wd-5-inner-ex-1
# Lab 5 Revised
# Growing comment: It looks like you are using values from one dataset to filter another dataset rather than joining two datasets together. The intention of this lab is to practice using joins!
# I used more joins to add the datasets person and drivers_license, so I could filter for the suspect in one pipeline. 
gym_people <- get_fit_now_member |>
  inner_join(get_fit_now_check_in, by = join_by(id == membership_id)) |>
  inner_join(person, by = join_by(person_id == id)) |>
  inner_join(drivers_license, by = join_by(license_id == id)) |>
  filter(str_detect(check_in_date, "20180109"),
         check_out_time >= 1600,
         membership_status =="gold",
         str_detect(plate_number, "H42W")
         ) 
gym_people
```

-   `inner_join()` Example 2

```{r}
#| label: wd-5-inner-ex-2
# Lab 5
# REVISED WHYYY
dec_symphony <- facebook_event_checkin |>
  left_join(hired, by = c("person_id" = "id")) |>
  filter(event_name == "SQL Symphony Concert",
         str_starts(date,"201712")) |>
  count(person_id, name = "n_checkins") |>
  filter(n_checkins >= 3) |>
  left_join(person, by = join_by(person_id == id)) |>
  inner_join(hired, by = join_by(name)) |>
  left_join(interview, by = join_by(person_id))
dec_symphony
```

**WD-6: I can use filtering joins to filter rows from a dataframe.**

-   `semi_join()`

```{r}
#| label: wd-6-semi
# Lab 5, Revised 

interview |>
  semi_join(suspects, 
    by = join_by(person_id)) |>
  select(transcript)
```

-   `anti_join()`

```{r}
#| label: wd-6-anti
# Lab 4, Question 5, Revised
# Instead of filtering for the years 2008 and 2018, Dr. Theobold helped me find a way to use an anti_join. I created a new dataset that contains all the years other than 2008 and 2018. Then I anti_joined this dataset to get years 2008 and 2018.
# Growing Comment: Notice that your table still has a grouping variable! Because you grouped by **two** variables, your first group was not dropped!
#Can you give your column names better titles, so the reader knows what "2008" and "2018" represent? What are the values stored in these columns?
# I used .groups = "drop" to drop all groups. I also used better column names that were more descriptive, instead of just the year. 

ca_childcare_years <- ca_childcare |> #NEW DATASET
  filter(!study_year %in% c(2008, 2018)) 


income_by_region <- ca_childcare |>
  anti_join(ca_childcare_years, by = join_by("study_year")) |> #ANTIJOIN WITH DATASET ABOVE
  group_by(county_region, study_year) |>   # groups by county_region and year (2008 and 2018)
  summarize(median_income = median(mhi_2018, na.rm = TRUE), .groups = "drop") |> # calculates the median of median household income and removes all grouping
  pivot_wider(names_from = study_year,   # changes format from long to wide
              values_from = median_income,
              names_prefix = "median_income_") |>
  arrange(desc(median_income_2018))   # arranges rows by 2018 values from highest to lowest

```

**WD-7: I can pivot dataframes from long to wide and visa versa**

-   `pivot_longer()`

```{r}
#| label: wd-7-long
# Lab 4 Question 7 Revised
# Success comment: Nice work pivoting and modifying the age variable!Nice work reordering your legend and your facets!!!Can you match my colors??? These are coming from a package and you will need to expand the color palette to get all 10 colors.
# Revised from midterm: I added dollar signs on the y-axis.

region_labels <- c(
  san_fran_counties            = "San Francisco Bay Area",
  inland_counties              = "Inland Empire",
  superior_counties            = "Superior California",
  north_coast_counties         = "North Coast",
  central_coast_counties       = "Central Coast",
  n_san_joaquin_counties       = "Northern San Joaquin Valley",
  s_san_joaquin_counties       = "Southern San Joaquin Valley",
  la_county                    = "Los Angeles County",
  orange_county                = "Orange County",
  san_diego_imperial_counties  = "San Diego–Imperial"
)
ca_childcare |>
  pivot_longer(cols = starts_with("mc_"),
             names_to = "age_group", names_prefix = "mc_",
             values_to = "weekly_price") |>
  mutate(age_group = str_to_title(age_group),
  county_region = fct_reorder2(.f = county_region,
                               .x = study_year,
                               .y = weekly_price)) |> 
  ggplot(mapping = aes(x = study_year, y = weekly_price, color = county_region)) +
  geom_point(alpha = 0.8, size = 0.6) +
  geom_smooth(method = "loess", linewidth = 0.5) + 
  facet_wrap(~ age_group) + 
  labs(
    title = "Weekly Median Price for Center-Based Childcare ($)",
    x = "Study Year",
    y = NULL,
    color = "California Region"
  ) + 
    scale_color_manual(
      breaks = names(region_labels),
      labels = region_labels,
      values = colorRampPalette(brewer.pal(8, "Accent"))(10)
  ) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    ) +
  scale_y_continuous(
    limits = c(100, 500),
    labels = label_currency()
  ) +
  theme_bw() +
  theme(
    aspect.ratio = 1,
    axis.text = element_text(size = 6),
    plot.title = element_text(size = 10),
    panel.border = element_rect(color = "black", fill = NA)
  )  
```

-   `pivot_wider()`

```{r}
#| label: wd-7-wide
# Lab 4 Question 5 Revised
# Growing Comment: Notice that your table still has a grouping variable! Because you grouped by **two** variables, your first group was not dropped! Can you give your column names better titles, so the reader knows what "2008" and "2018" represent? What are the values stored in these columns?
# I added .groups = "drop" to make sure that all grouping is removed. I also added prefixes to the column names to make it clear to the reader what values are in these columns. 

income_by_region <- ca_childcare |>
  filter(study_year %in% c(2008, 2018)) |>
  group_by(county_region, study_year) |>
  summarize(median_income = median(mhi_2018, na.rm = TRUE), .groups = "drop") |>
  pivot_wider(names_from = study_year,
              values_from = median_income,
              names_prefix = "median_income_") |>
  arrange(desc(median_income_2018))

income_by_region
```

## Reproducibility

**R-1: I can create professional looking, reproducible analyses using RStudio projects, Quarto documents, and the here package.**

The following assignments satisfy the above criteria:

-   Lab 2
-   Lab 3
-   Lab 4
-   Lab 5
-   Challenge 3

**R-2: I can write well documented and tidy code.**

-   Example of **ggplot2** plotting

```{r}
#| label: r-2-1
# Challenge 3 Question 2, Revised
# Success comment: Incredible work! Nice job matching the colors, the percentage labels, and the legend position! Your colors are SO close! I chose colors from the Valkyries. You can use a color picker app (or Chrome extension) to feed in a plot / website and get the hex codes for the colors out! Then you don’t have to memorize what my favorite colors are. :)

ggplot(data = teacher_evals_compare) +
  # creates bar graph 
  geom_bar(
    mapping = aes(x = sen_level, fill = set_level),
    position = "fill"
  ) +
  # manually changes graph colors
  scale_fill_manual(
    values = c(
      "excellent" = "#B897D4",  
      "standard"  = "#BA965C"   
    )
  ) +
  # adds labels for title, axes, and legend
  labs(
    title = "Evaluation of Teachers' Use of Activities",
    x = "Years of Experience",
    y = NULL,
    fill = "Evaluation Rating"
  ) +
  # adjust theme to put legend at top and add border
  theme_minimal() + 
  theme(
    legend.position = "top",
    panel.border = element_rect(color = "black")
  ) +
  # adds percents for the y-axis
  scale_y_continuous(labels = scales::label_percent())
  

```

-   Example of **dplyr** pipeline

```{r}
#| label: r-2-2
# Lab 4 Question 5 Revised
# Growing Comment: Notice that your table still has a grouping variable! Because you grouped by **two** variables, your first group was not dropped! Can you give your column names better titles, so the reader knows what "2008" and "2018" represent? What are the values stored in these columns?
# I added .groups = "drop" to make sure that all grouping is removed. I also added prefixes to the column names to make it clear to the reader what values are in these columns. 

income_by_region <- ca_childcare |>
  filter(study_year %in% c(2008, 2018)) |>   #filters for year 2008 and 2018
  group_by(county_region, study_year) |>   # groups by county_region and year (2008 and 2018)
  summarize(median_income = median(mhi_2018, na.rm = TRUE), .groups = "drop") |> # calculates the median of median household income and removes all grouping
  pivot_wider(names_from = study_year,   # changes format from long to wide
              values_from = median_income,
              names_prefix = "median_income_") |>
  arrange(desc(median_income_2018))   # arranges rows by 2018 values from highest to lowest

income_by_region
```

-   Example of function formatting

```{r}
#| label: r-2-3
# Lab 8, Revised
# Growing Comment: Is there an argument in pivot_wider() that will fill in the NAs with 0s? Input checks for data frame functions are tricky, but an easy one is to check if the data frame being input is actually a data frame (not a vector or a matrix).
# I revised my code to use values_fill = 0 instead of mutate and I added an input check. 

pivot_table <- function(df, row_var, col_var) {
  stopifnot("Input must be a data frame" = is.data.frame(df)) # input validation
  
  df |>
    count( {{ row_var }}, {{ col_var }}) |> # count frequency for each row and column combination
    pivot_wider(
      names_from = {{ col_var }}, # columns names are from col_var
      values_from = n,            # cell values are from counts
      values_fill = 0             # fills missing values with 0
    ) |> 
    janitor::adorn_totals(where = c("row", "col")) # adds row and column totals
}
```

**R-3: I can write robust programs that are resistant to changes in inputs.**

-   Example (any context)

```{r}
#| label: r-3-example
# Lab 8, Question 3, Revised
# Growing Comment: Input checks for data frame functions are tricky, but an easy one is to check if the data frame being input is actually a data frame (not a vector or a matrix).
#Nice work including color in your plots! Technically, your legend has the same information as your facets, so I would recommend removing it. We don't want to have redundant information in our plots!
#You should use:
#theme(legend_position = “none")
# I added a function check to check if the data frame input is a data frame. I also removed the legend from the plot because it contained redundannt information.

create_plot <- function(df, x_var, y_var, group) {
  stopifnot("Input must be a data frame" = is.data.frame(df))
  x_label <- as_label(enquo(x_var)) |>
    str_replace_all(pattern = "_", replacement = " ")
  y_label <- as_label(enquo(y_var)) |>
    str_replace_all(pattern = "_", replacement = " ")
  g_label <- as_label(enquo(group)) |>
    str_replace_all(pattern = "_", replacement = " ")
  
  df |>
    ggplot(mapping = aes(x = {{ x_var }}, y = {{ y_var }}, color = {{ group }})) +
      geom_point(na.rm = TRUE) +
      geom_smooth(method = "lm", formula = y ~ x, se = FALSE, na.rm = TRUE) + 
      facet_wrap(vars({{ group }}),
                 scales = "free_x") + 
      labs(
        x = x_label,
        y = y_label,
        title = str_to_title(paste("Relationship between", y_label, "and", x_label, "by", g_label))
      ) + 
      theme_bw() +
      theme(legend.position = "none") 
}

```

-   Example (function stops)

```{r}
#| label: r-3-function-stops
# Challenge 7, Question 4, Revised 
# Growing Comment: Where are your function checks? What types of inputs does your function expect?
# I added function checks to make my program resistant to incorrect inputs. 
calculate_index <- function(weight, length) {
  stopifnot("Input must be numeric" = is.numeric(weight),
            "Input must be numeric" = is.numeric(length),
            "Weight must be positive" = weight > 0,
            "Length must be positive" = length > 0)
  index = weight / (length^3) * 100
  return(index)
}

```

## Data Visualization & Summarization

**DVS-1: I can create visualizations for a *variety* of variable types (e.g., numeric, character, factor, date)**

-   At least two numeric variables

```{r}
#| label: dvs-1-num
# Lab 4 Question 8, Revised
# Success comment: Wouldn’t it be nice to add $ signs before these currency values?
# Revised from midterm: I used label_currency() instead of label_dollar(). 

ggplot(data = ca_childcare, mapping = aes(x = mhi_2018, y = mc_infant)) +
  geom_point(alpha = 0.8) + 
  geom_smooth(method = "lm") + 
  labs(
    x = "Median Household Income (2018)",
    y = NULL,
    title = "Weekly Median Price for Center-Based Childcare ($)"
  ) + 
  scale_x_continuous(labels = label_currency()) + 
  theme_bw()
```

-   At least one numeric variable and one categorical variable

```{r}
#| label: dvs-2-num-cat
# Lab 2 Challenge
# Revised from midterm: I had tilted the x axis labels for no reason, so I just got rid of that.

ggplot(data = surveys,
        mapping = aes(x = weight, y = species, color = sex)) +
        geom_jitter(color = "#808080", alpha = 0.2) +
        scale_color_manual(values = c("M" = "#00008B",
                                      "F" = "#FF0000")) +
        geom_boxplot(outliers = FALSE) +
        labs(
            x = "Weight (g)",
            y = "Species of Rodent in Portal, AZ",
            title = "Weight of Rodent Species in Portal, AZ",
            subtitle = "Separated by <span style =
        'color:#00008B;'>M</span> and <span style =
        'color:#FF0000;'>F</span> Sex") +
        theme_bw() + 
        theme (
          legend.position = "none",
          plot.subtitle = element_markdown()
         ) 
```

-   At least two categorical variables

```{r}
#| label: dvs-2-cat
# Challenge 3 Question 2 Revised
# Success comment: Incredible work! Nice job matching the colors, the percentage labels, and the legend position! Your colors are SO close! I chose colors from the Valkyries. You can use a color picker app (or Chrome extension) to feed in a plot / website and get the hex codes for the colors out! Then you don’t have to memorize what my favorite colors are. :)

ggplot(data = teacher_evals_compare) +
  # creates bar graph 
  geom_bar(
    mapping = aes(x = sen_level, fill = set_level),
    position = "fill"
  ) +
  # manually changes graph colors
  scale_fill_manual(
    values = c(
      "excellent" = "#B897D4",  
      "standard"  = "#BA965C"   
    )
  ) +
  # adds labels for title, axes, and legend
  labs(
    title = "Evaluation of Teachers' Use of Activities",
    x = "Years of Experience",
    y = NULL,
    fill = "Evaluation Rating"
  ) +
  # adjust theme to put legend at top and add border
  theme_minimal() + 
  theme(
    legend.position = "top",
    panel.border = element_rect(color = "black")
  ) +
  # adds percents for the y-axis
  scale_y_continuous(labels = scales::label_percent())

```

-   Dates (time series plot)

```{r}
#| label: dvs-2-date
# Lab 4 Question 7 Revised
# Success comment: Nice work pivoting and modifying the age variable!Nice work reordering your legend and your facets!!!Can you match my colors??? These are coming from a package and you will need to expand the color palette to get all 10 colors.
# Revised from midterm: I added dollar signs on the y-axis.

region_labels <- c(
  san_fran_counties            = "San Francisco Bay Area",
  inland_counties              = "Inland Empire",
  superior_counties            = "Superior California",
  north_coast_counties         = "North Coast",
  central_coast_counties       = "Central Coast",
  n_san_joaquin_counties       = "Northern San Joaquin Valley",
  s_san_joaquin_counties       = "Southern San Joaquin Valley",
  la_county                    = "Los Angeles County",
  orange_county                = "Orange County",
  san_diego_imperial_counties  = "San Diego–Imperial"
)
ca_childcare |>
  pivot_longer(cols = starts_with("mc_"),
             names_to = "age_group", names_prefix = "mc_",
             values_to = "weekly_price") |>
  mutate(age_group = str_to_title(age_group),
  county_region = fct_reorder2(.f = county_region,
                               .x = study_year,
                               .y = weekly_price)) |> 
  ggplot(mapping = aes(x = study_year, y = weekly_price, color = county_region)) +
  geom_point(alpha = 0.8, size = 0.6) +
  geom_smooth(method = "loess", linewidth = 0.5) + 
  facet_wrap(~ age_group) + 
  labs(
    title = "Weekly Median Price for Center-Based Childcare ($)",
    x = "Study Year",
    y = NULL,
    color = "California Region"
  ) + 
    scale_color_manual(
      breaks = names(region_labels),
      labels = region_labels,
      values = colorRampPalette(brewer.pal(8, "Accent"))(10)
  ) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    ) +
  scale_y_continuous(
    limits = c(100, 500),
    labels = label_currency()
  ) +
  theme_bw() +
  theme(
    aspect.ratio = 1,
    axis.text = element_text(size = 6),
    plot.title = element_text(size = 10),
    panel.border = element_rect(color = "black", fill = NA)
  )  
```

**DVS-2: I use plot modifications to make my visualization clear to the reader.**

-   I can modify my plot theme to be more readable

```{r}
#| label: dvs-2-ex-1
# Lab 4 Question 7 Revised
# Success comment: Nice work pivoting and modifying the age variable!Nice work reordering your legend and your facets!!!Can you match my colors??? These are coming from a package and you will need to expand the color palette to get all 10 colors.
# Revised from midterm: I added dollar signs on the y-axis.

region_labels <- c(
  san_fran_counties            = "San Francisco Bay Area",
  inland_counties              = "Inland Empire",
  superior_counties            = "Superior California",
  north_coast_counties         = "North Coast",
  central_coast_counties       = "Central Coast",
  n_san_joaquin_counties       = "Northern San Joaquin Valley",
  s_san_joaquin_counties       = "Southern San Joaquin Valley",
  la_county                    = "Los Angeles County",
  orange_county                = "Orange County",
  san_diego_imperial_counties  = "San Diego–Imperial"
)
ca_childcare |>
  pivot_longer(cols = starts_with("mc_"),
             names_to = "age_group", names_prefix = "mc_",
             values_to = "weekly_price") |>
  mutate(age_group = str_to_title(age_group),
  county_region = fct_reorder2(.f = county_region,
                               .x = study_year,
                               .y = weekly_price)) |> 
  ggplot(mapping = aes(x = study_year, y = weekly_price, color = county_region)) +
  geom_point(alpha = 0.8, size = 0.6) +
  geom_smooth(method = "loess", linewidth = 0.5) + 
  facet_wrap(~ age_group) + 
  labs(
    title = "Weekly Median Price for Center-Based Childcare ($)",
    x = "Study Year",
    y = NULL,
    color = "California Region"
  ) + 
    scale_color_manual(
      breaks = names(region_labels),
      labels = region_labels,
      values = colorRampPalette(brewer.pal(8, "Accent"))(10)
  ) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    ) +
  scale_y_continuous(
    limits = c(100, 500),
    labels = label_currency()
  ) +
  theme_bw() +
  theme(
    aspect.ratio = 1,
    axis.text = element_text(size = 6),
    plot.title = element_text(size = 10),
    panel.border = element_rect(color = "black", fill = NA)
  ) 
```

-   I can modify my colors to be accessible to anyone's eyes

```{r}
#| label: dvs-2-ex-2
# Lab 2 Challenge
# Success Comment: Nice Work!
# Revised from midterm: I had tilted the x axis labels for no reason, so I just got rid of that.

ggplot(data = surveys,
        mapping = aes(x = weight, y = species, color = sex)) +
        geom_jitter(color = "#808080", alpha = 0.2) +
        scale_color_manual(values = c("M" = "#00008B",
                                      "F" = "#FF0000")) +
        geom_boxplot(outliers = FALSE) +
        labs(
            x = "Weight (g)",
            y = "Species of Rodent in Portal, AZ",
            title = "Weight of Rodent Species in Portal, AZ",
            subtitle = "Separated by <span style =
        'color:#00008B;'>M</span> and <span style =
        'color:#FF0000;'>F</span> Sex") +
        theme_bw() + 
        theme (
          legend.position = "none",
          plot.subtitle = element_markdown()
         ) 
        
```

-   I can modify my plot titles to clearly communicate the data context

```{r}
#| label: dvs-2-ex-3
# Lab 2 Challenge
# Success Comment: Nice Work!
# Revised from midterm: I had tilted the x axis labels for no reason, so I just got rid of that.

ggplot(data = surveys,
        mapping = aes(x = weight, y = species, color = sex)) +
        geom_jitter(color = "#808080", alpha = 0.2) +
        scale_color_manual(values = c("M" = "#00008B",
                                      "F" = "#FF0000")) +
        geom_boxplot(outliers = FALSE) +
        labs(
            x = "Weight (g)",
            y = "Species of Rodent in Portal, AZ",
            title = "Weight of Rodent Species in Portal, AZ",
            subtitle = "Separated by <span style =
        'color:#00008B;'>M</span> and <span style =
        'color:#FF0000;'>F</span> Sex") +
        theme_bw() + 
        theme (
          legend.position = "none",
          plot.subtitle = element_markdown()
         ) 
```

-   I can modify the text in my plot to be more readable

```{r}
#| label: dvs-2-ex-4
# Lab 4 Question 7 Revised
# Success comment: Nice work pivoting and modifying the age variable!Nice work reordering your legend and your facets!!!Can you match my colors??? These are coming from a package and you will need to expand the color palette to get all 10 colors.

region_labels <- c(
  san_fran_counties            = "San Francisco Bay Area",
  inland_counties              = "Inland Empire",
  superior_counties            = "Superior California",
  north_coast_counties         = "North Coast",
  central_coast_counties       = "Central Coast",
  n_san_joaquin_counties       = "Northern San Joaquin Valley",
  s_san_joaquin_counties       = "Southern San Joaquin Valley",
  la_county                    = "Los Angeles County",
  orange_county                = "Orange County",
  san_diego_imperial_counties  = "San Diego–Imperial"
)
ca_childcare |>
  pivot_longer(cols = c(mc_infant, mc_toddler, mc_preschool),
             names_to = "age_group", names_prefix = "mc_",
             values_to = "weekly_price") |>
  mutate(age_group = str_to_title(age_group),
  county_region = fct_reorder2(.f = county_region,
                               .x = study_year,
                               .y = weekly_price)) |> 
  ggplot(mapping = aes(x = study_year, y = weekly_price, color = county_region)) +
  geom_point(alpha = 0.8, size = 0.6) +
  geom_smooth(method = "loess", linewidth = 0.5) + 
  facet_wrap(~ age_group) + 
  labs(
    title = "Weekly Median Price for Center-Based Childcare ($)",
    x = "Study Year",
    y = NULL,
    color = "California Region"
  ) + 
    scale_color_manual(
    breaks = names(region_labels),
    labels = region_labels,
    values = colorRampPalette(brewer.pal(8, "Accent"))(10)
  ) +
  scale_x_continuous(breaks = seq(2008, 2018, by = 2)) + 
  scale_y_continuous(limits = c(100, 500)) +
  theme_bw() +
  theme(
    aspect.ratio = 1,
    axis.text = element_text(size = 6),
    plot.title = element_text(size = 10),
    panel.border = element_rect(color = "black", fill = NA)
  )  
```

-   I can reorder my legend to align with the colors in my plot

```{r}
#| label: dvs-2-ex-5
# Lab 4 Question 7 Revised
# Success comment: Nice work pivoting and modifying the age variable!Nice work reordering your legend and your facets!!!Can you match my colors??? These are coming from a package and you will need to expand the color palette to get all 10 colors.

region_labels <- c(
  san_fran_counties            = "San Francisco Bay Area",
  inland_counties              = "Inland Empire",
  superior_counties            = "Superior California",
  north_coast_counties         = "North Coast",
  central_coast_counties       = "Central Coast",
  n_san_joaquin_counties       = "Northern San Joaquin Valley",
  s_san_joaquin_counties       = "Southern San Joaquin Valley",
  la_county                    = "Los Angeles County",
  orange_county                = "Orange County",
  san_diego_imperial_counties  = "San Diego–Imperial"
)
ca_childcare |>
  pivot_longer(cols = c(mc_infant, mc_toddler, mc_preschool),
             names_to = "age_group", names_prefix = "mc_",
             values_to = "weekly_price") |>
  mutate(age_group = str_to_title(age_group),
  county_region = fct_reorder2(.f = county_region,
                               .x = study_year,
                               .y = weekly_price)) |> 
  ggplot(mapping = aes(x = study_year, y = weekly_price, color = county_region)) +
  geom_point(alpha = 0.8, size = 0.6) +
  geom_smooth(method = "loess", linewidth = 0.5) + 
  facet_wrap(~ age_group) + 
  labs(
    title = "Weekly Median Price for Center-Based Childcare ($)",
    x = "Study Year",
    y = NULL,
    color = "California Region"
  ) + 
    scale_color_manual(
    breaks = names(region_labels),
    labels = region_labels,
    values = colorRampPalette(brewer.pal(8, "Accent"))(10)
  ) +
  scale_x_continuous(breaks = seq(2008, 2018, by = 2)) + 
  scale_y_continuous(limits = c(100, 500)) +
  theme_bw() +
  theme(
    aspect.ratio = 1,
    axis.text = element_text(size = 6),
    plot.title = element_text(size = 10),
    panel.border = element_rect(color = "black", fill = NA)
  )  
```

**DVS-3: I show creativity in my visualizations**

-   I can use non-standard colors (Example 1)

```{r}
#| label: dvs-3-1-ex-1
# Lab 4 Question 7 Revised
# Success comment: Nice work pivoting and modifying the age variable!Nice work reordering your legend and your facets!!!Can you match my colors??? These are coming from a package and you will need to expand the color palette to get all 10 colors.

region_labels <- c(
  san_fran_counties            = "San Francisco Bay Area",
  inland_counties              = "Inland Empire",
  superior_counties            = "Superior California",
  north_coast_counties         = "North Coast",
  central_coast_counties       = "Central Coast",
  n_san_joaquin_counties       = "Northern San Joaquin Valley",
  s_san_joaquin_counties       = "Southern San Joaquin Valley",
  la_county                    = "Los Angeles County",
  orange_county                = "Orange County",
  san_diego_imperial_counties  = "San Diego–Imperial"
)
ca_childcare |>
  pivot_longer(cols = c(mc_infant, mc_toddler, mc_preschool),
             names_to = "age_group", names_prefix = "mc_",
             values_to = "weekly_price") |>
  mutate(age_group = str_to_title(age_group),
  county_region = fct_reorder2(.f = county_region,
                               .x = study_year,
                               .y = weekly_price)) |> 
  ggplot(mapping = aes(x = study_year, y = weekly_price, color = county_region)) +
  geom_point(alpha = 0.8, size = 0.6) +
  geom_smooth(method = "loess", linewidth = 0.5) + 
  facet_wrap(~ age_group) + 
  labs(
    title = "Weekly Median Price for Center-Based Childcare ($)",
    x = "Study Year",
    y = NULL,
    color = "California Region"
  ) + 
    scale_color_manual(
    breaks = names(region_labels),
    labels = region_labels,
    values = colorRampPalette(brewer.pal(8, "Accent"))(10)
  ) +
  scale_x_continuous(breaks = seq(2008, 2018, by = 2)) + 
  scale_y_continuous(limits = c(100, 500)) +
  theme_bw() +
  theme(
    aspect.ratio = 1,
    axis.text = element_text(size = 6),
    plot.title = element_text(size = 10),
    panel.border = element_rect(color = "black", fill = NA)
  )  
```

-   I can use non-standard colors (Example 2)

```{r}
#| label: dvs-3-1-ex-2
# Challenge 3 Question 2 Revised
# Success comment: Incredible work! Nice job matching the colors, the percentage labels, and the legend position! Your colors are SO close! I chose colors from the Valkyries. You can use a color picker app (or Chrome extension) to feed in a plot / website and get the hex codes for the colors out! Then you don’t have to memorize what my favorite colors are. :)

ggplot(data = teacher_evals_compare) +
  # creates bar graph 
  geom_bar(
    mapping = aes(x = sen_level, fill = set_level),
    position = "fill"
  ) +
  # manually changes graph colors
  scale_fill_manual(
    values = c(
      "excellent" = "#B897D4",  
      "standard"  = "#BA965C"   
    )
  ) +
  # adds labels for title, axes, and legend
  labs(
    title = "Evaluation of Teachers' Use of Activities",
    x = "Years of Experience",
    y = NULL,
    fill = "Evaluation Rating"
  ) +
  # adjust theme to put legend at top and add border
  theme_minimal() + 
  theme(
    legend.position = "top",
    panel.border = element_rect(color = "black")
  ) +
  # adds percents for the y-axis
  scale_y_continuous(labels = scales::label_percent())
  
    
```

-   I can use annotations (e.g., `geom_text()`)

```{r}
#| label: dvs-3-2
# Lab 10 Question 13 
set.seed(10)
ci_dat_100 <- map(.x = 1:100,
                  .f = ~ mycifun(beta0 = 3, beta1 = 0.5, n = 100)) |>
  bind_rows() |>
  mutate(cover = factor(cover, levels = c(0, 1)))
  

ggplot(data = ci_dat_100,
       mapping = aes(y = seq_len(nrow(ci_dat_100)),
                     xmin = conf.low,
                     xmax = conf.high,
                     color = cover)) +
  geom_errorbarh() +
  annotate("text", x = 0.9, y = 105, label = "population slope = 0.5", size = 3) + 
  geom_vline(xintercept = 0.5, linetype = "dashed") +
  scale_color_manual(
    values = c(
    "0" = "#EA7D70",  
    "1"  = "#7DBBE0"
  )) +
  scale_x_continuous(breaks = seq(from = -1, to = 2, by = 0.5)) +
  scale_y_continuous(breaks = NULL) + 
  labs(
    title = "95% Confidence Intervals of Estimated Regression Slope\nfor 100 Simulated Datasets",
    subtitle = "CI’s that do not include the population slope are highlighted in <span style = 'color:#C23B22;'>red</span>",
    x = "Slope Coefficient Estimate",
    y = NULL
  ) + 
  theme_minimal() + 
  theme(legend.position = "none",
        plot.subtitle = element_markdown())
```

-   I can choose creative geometries (e.g., `geom_segment()`, `geom_ribbon)()`)

```{r}
#| label: dvs-3-3
# Lab 10 Question 13 
set.seed(10)
ci_dat_100 <- map(.x = 1:100,
                  .f = ~ mycifun(beta0 = 3, beta1 = 0.5, n = 100)) |>
  bind_rows() |>
  mutate(cover = factor(cover, levels = c(0, 1)))
  

ggplot(data = ci_dat_100,
       mapping = aes(y = seq_len(nrow(ci_dat_100)),
                     xmin = conf.low,
                     xmax = conf.high,
                     color = cover)) +
  geom_errorbarh() +
  annotate("text", x = 0.9, y = 105, label = "population slope = 0.5", size = 3) + 
  geom_vline(xintercept = 0.5, linetype = "dashed") +
  scale_color_manual(
    values = c(
    "0" = "#EA7D70",  
    "1"  = "#7DBBE0"
  )) +
  scale_x_continuous(breaks = seq(from = -1, to = 2, by = 0.5)) +
  scale_y_continuous(breaks = NULL) + 
  labs(
    title = "95% Confidence Intervals of Estimated Regression Slope\nfor 100 Simulated Datasets",
    subtitle = "CI’s that do not include the population slope are highlighted in <span style = 'color:#C23B22;'>red</span>",
    x = "Slope Coefficient Estimate",
    y = NULL
  ) + 
  theme_minimal() + 
  theme(legend.position = "none",
        plot.subtitle = element_markdown())
```

**DVS-4: I can calculate numerical summaries of variables.**

-   Example using `summarize()`

```{r}
#| label: dvs-4-summarize
# Lab 3 Question 6
# Success comment: Nice work! This is an efficient way to get both summaries in one function call!

teacher_evals_clean |>
  summarize(
    n_distinct(teacher_id),
    n_distinct(course_id)
  )
    
```

-   Example using `across()`

```{r}
#| label: dvs-4-across
# Lab 7 Question 1
fish_missing <- fish |>
  # shows how many missing values for each variable
  summarize(across(.cols = everything(), .fns = ~ sum(is.na(.x))))

fish_missing
```

**DVS-5: I can find summaries of variables across multiple groups.**

-   Example 1

```{r}
#| label: dvs-5-1
# Lab 3 Question 10 Revised
# Growing Comment: Can you do this in one call to the summarize function?Is there a function that allows you to slice the max of a specific variable? Is there a way you can get the max *and* min in **one** pipeline?
# In office hours we discussed how slice_min and slice_max could be used, but there was an even more efficient way to find the max and min using filter. 

Q10 <- teacher_evals_clean |>
  filter(question_no == 901) |>
  group_by(teacher_id) |> 
  summarize(course_avg = mean(SET_score_avg), n_courses = n_distinct(course_id)) |>
  filter(n_courses > 4) |>
  filter(course_avg == max(course_avg) |
         course_avg == min(course_avg))

#slice_min(Q10, order_by = course_avg)
#slice_max(Q10, order_by = course_avg)

Q10
```

-   Example 2

```{r}
#| label: dvs-5-2
# Lab 3 Question 9
teacher_evals_clean |>
  group_by(teacher_id, course_id) |>
  summarize(questions = n_distinct(question_no)) |>
  filter(questions == 9) |>
  nrow()
```

**DVS-6: I can create tables which make my summaries clear to the reader.**

-   I can modify my column names to clearly communicate the data context

```{r}
#| label: dvs-6-ex-1
# Lab 4 Question 5 Revised
# Growing Comment: Notice that your table still has a grouping variable! Because you grouped by **two** variables, your first group was not dropped! Can you give your column names better titles, so the reader knows what "2008" and "2018" represent? What are the values stored in these columns?
# I added .groups = "drop" to make sure that all grouping is removed. I also added prefixes to the column names to make it clear to the reader what values are in these columns. 

income_by_region <- ca_childcare |>
  filter(study_year %in% c(2008, 2018)) |>   #filters for year 2008 and 2018
  group_by(county_region, study_year) |>   # groups by county_region and year (2008 and 2018)
  summarize(median_income = median(mhi_2018, na.rm = TRUE), .groups = "drop") |> # calculates the median of median household income and removes all grouping
  pivot_wider(names_from = study_year,   # changes format from long to wide
              values_from = median_income,
              names_prefix = "median_income_") |>
  arrange(desc(median_income_2018))   # arranges rows by 2018 values from highest to lowest

income_by_region
```

-   I can modify the text in my table to be more readable (e.g., bold face for column headers)

```{r}
#| label: dvs-6-ex-2
# Lab 9, Question 3
# Growing comment: Should all the entries be boldface? Notice that Date is capitalized and the rest of the data types are lower case? How would you use a stringr function to remedy that?
# To bold only the column header I used row_spec and selected row 0 to be bolded instead of using column_spec and bolding both columns which made all entries bold. Data was capitalized, so I used str_to_lower to make it lowercase like the rest of the data types. 
  map_chr(.x = surveys, .f = class) |>
  enframe() |>
  mutate(value = str_to_lower(value)) |>
  arrange(value, name) |>
  kable(
    caption = "Data Types of Variables in Surveys Dataset on Rodents",
    col.names = c("Variable", "Data Type")
  ) |>
  kable_styling(font_size = 12) |>
  row_spec(
    row = 0,
    bold = TRUE
  ) 
```

-   I can arrange my table to have an intuitive ordering

```{r}
#| label: dvs-6-ex-3
# Lab 4 Question 5 Revised
# Growing Comment: Notice that your table still has a grouping variable! Because you grouped by **two** variables, your first group was not dropped! Can you give your column names better titles, so the reader knows what "2008" and "2018" represent? What are the values stored in these columns?
# I added .groups = "drop" to make sure that all grouping is removed. I also added prefixes to the column names to make it clear to the reader what values are in these columns. 

income_by_region <- ca_childcare |>
  filter(study_year %in% c(2008, 2018)) |>   #filters for year 2008 and 2018
  group_by(county_region, study_year) |>   # groups by county_region and year (2008 and 2018)
  summarize(median_income = median(mhi_2018, na.rm = TRUE), .groups = "drop") |> # calculates the median of median household income and removes all grouping
  pivot_wider(names_from = study_year,   # changes format from long to wide
              values_from = median_income,
              names_prefix = "median_income_") |>
  arrange(desc(median_income_2018))   # arranges rows by 2018 values from highest to lowest

income_by_region
```

**DVS-7: I show creativity in my tables.**

-   I can use non-default colors

```{r}
#| label: dvs-7-ex-1
# Lab 9, Question 8, Revised
# Growing comment: I want the entire cell to be colored!
# I used column_spec instead of cell_spec. Using kable was a little funky because I had to tell the program where the column `Missing Values` was coming from. 

missing <- fish |>
  map_int(.f = ~ sum(is.na(.x))) |>
  enframe(name = "Measurement Variable", value = "Missing Values") |>
    arrange(`Missing Values`)

missing |> 
  kbl(escape = FALSE) |>
  kable_styling(full_width = FALSE) |>
  column_spec(2, background = ifelse(missing$`Missing Values` > 0, "#FFE4C4", "#E0FFFF")) |>
  add_header_above(
    c("Number of Missing Values for Fish Measurements" = 2),
    font_size = 20) |>
  footnote(general = "Data Collected from 1989 to 2006 on the Blackfoot Fish River in Montana")
```

-   I can modify the layout of my table to be more readable (e.g., `pivot_longer()` or `pivot_wider()`)

```{r}
#| label: dvs-7-ex-2
# Lab 9, Question 5 
# Growing comment: There is no table being output!
# I had made a silly mistake and misnamed a key variable. As a result, the table wasn't being output. 
evals |>
  distinct(teacher_id, .keep_all = TRUE) |>
  mutate(
    academic_degree = fct_recode(
      academic_degree,
      "Doctorate" = "dr",
      "Masters" = "ma",
      "No Degree" = "no_dgr",
      "Tenured Professor" = "prof"
    ),
    sex = fct_recode(
      sex,
      "Male" = "male",
      "Female" = "female"
    ),
    seniority_group = case_when(
      seniority %in% 1:4 ~ "Junior",
      seniority %in% 5:8 ~ "Senior",
      seniority %in% 9:12 ~ "Very Senior"
    ) |>
      factor(levels = c("Junior", "Senior", "Very Senior"))
  ) |>
  select(
    academic_degree,
    seniority = seniority_group,
    sex
  ) |>
  pivot_longer(
    cols = c(academic_degree, seniority, sex),
    names_to = "Variable",
    values_to = "Level"
  ) |>
  mutate(
    Variable = case_when(
      Variable == "academic_degree" ~ "Academic Degree",
      Variable == "seniority" ~ "Seniority",
      Variable == "sex" ~ "Sex"
    )
  ) |>
  count(Variable, Level) |>
  group_by(Variable) |>
  mutate(prop = n / sum(n)) |>
  ungroup() |>
  kable() |>
  kable_styling(full_width = FALSE, bootstrap_options = "striped")
  
```

## Program Efficiency

**PE-1: I can write concise code which does not repeat itself.**

-   using a single function call with multiple inputs (rather than multiple function calls)

```{r}
#| label: pe-1-one-call
# Lab 5
# Growing comment: It looks like you are using values from one dataset to filter another dataset rather than joining two datasets together. The intention of this lab is to practice using joins!
# I used more joins to add the datasets person and drivers_license, so I could filter for the suspect in one pipeline.
gym_people <- get_fit_now_member |>
  inner_join(get_fit_now_check_in, by = c("id" = "membership_id")) |>
  inner_join(person, by = c("person_id" = "id")) |>
  inner_join(drivers_license, by = c("license_id" = "id")) |>
  filter(str_detect(check_in_date, "20180109"),
         check_out_time >= 1600,
         membership_status == "gold",
         str_detect(plate_number, "H42W")
         ) 
gym_people
```

-   using `across()`

```{r}
#| label: pe-1-across
# Lab 3 Question 5 Revised
# Success comment: "Nice use of across!"

teacher_evals_clean <- evals |>
  rename(sex = gender) |>
  filter(no_participants >= 10) |>
  mutate(across(.cols = c(course_id, teacher_id), .fns = ~ as.character(.x)),
         across(.cols = c(question_no, academic_degree, sex), .fns = ~ as.factor(.x)),
         no_participants = as.integer(no_participants)
         ) |>
  select(course_id, teacher_id, question_no, no_participants, resp_share, SET_score_avg, percent_failed_cur, academic_degree, seniority, sex)

```

-   using functions from the `map()` family

```{r}
#| label: pe-1-map-1
# Lab 9, Question 7

fish |>
  map_int(.f = ~ sum(is.na(.x))) |>
  enframe(name = "Measurement Variable", value = "Missing Values") |>
  arrange(`Missing Values`)

```

**PE-2: I can write functions to reduce repetition in my code.**

-   Example 1: Function that operates on vectors

```{r}
#| label: pe-2-1
# Lab 7, Question 4, Revised
# I used range() to make my code more efficient.
rescale_01 <- function(vec) {
  stopifnot("Input must be numeric" = is.numeric(vec),
            "Input must have length > 0" = length(vec) > 0)
  rng <- range(vec, na.rm = TRUE)
  (vec - rng[1]) / (rng[2] - rng[1])
}
```

-   Example 2: Function that operates on data frames

```{r}
#| label: pe-2-2
# Lab 8, Revised
# Growing Comment: Is there an argument in pivot_wider() that will fill in the NAs with 0s? Input checks for data frame functions are tricky, but an easy one is to check if the data frame being input is actually a data frame (not a vector or a matrix).
# I revised my code to use values_fill = 0 instead of mutate and I added an input check. 

pivot_table <- function(df, row_var, col_var) {
  stopifnot("Input must be a data frame" = is.data.frame(df)) # input validation
  
  df |>
    count( {{ row_var }}, {{ col_var }}) |> # count frequency for each row and column combination
    pivot_wider(
      names_from = {{ col_var }}, # columns names are from col_var
      values_from = n,            # cell values are from counts
      values_fill = 0             # fills missing values with 0
    ) |> 
    janitor::adorn_totals(where = c("row", "col")) # adds row and column totals
}
```

-   Example 3: Function that operates on vectors *or* data frames

```{r}
#| label: pe-2-3
# Lab 8, Question 1 Revised
# Success comment: Input checks for data frame functions are tricky, but an easy one is to check if the data frame being input is actually a data frame (not a vector or a matrix).
# I added a data frame input check. 

rescale_column <- function(df, cols) {
  stopifnot("Input must be a data frame" = is.data.frame(df))
  df |>
    mutate(
      across(.cols = {{ cols }},
             .fns = ~ rescale_01(.x))
    )
}
```

**PE-3:I can use iteration to reduce repetition in my code.**

-   using `across()`

```{r}
#| label: pe-3-across
# Lab 8, Question 1 Revised
# Success comment: Input checks for data frame functions are tricky, but an easy one is to check if the data frame being input is actually a data frame (not a vector or a matrix).
# I added a data frame input check. 

rescale_column <- function(df, cols) {
  stopifnot("Input must be a data frame" = is.data.frame(df))
  df |>
    mutate(
      across(.cols = {{ cols }},
             .fns = ~ rescale_01(.x))
    )
}
```

-   using a `map()` function with **one** input (e.g., `map()`, `map_chr()`, `map_dbl()`, etc.)

```{r}
#| label: pe-3-map-1
# Lab 9, Question 4
evals |>
  map_if(.p = is.character, .f = ~ as.factor(.x)) |>
  bind_cols()
```

-   using a `map()` function with **more than one** input (e.g., `map_2()` or `pmap()`)

```{r}
#| label: pe-3-map-2
# Lab 9, Question 3, Revised
# Should all the entries be boldface? Notice that Date is capitalized and the rest of the data types are lower case? How would you use a stringr function to remedy that?
# To complete this portfolio checkpoint, I revised my code to use map2_df.  
var_names <- names(surveys) # column names
data_types <- map_chr(.x = surveys, .f = class) # finds the class 

map2_df(
  .x = var_names,
  .y = data_types,
  .f = ~ tibble(
    Variable = .x,
    `Data Type` = .y
  )
) |>
  arrange(`Data Type`, Variable) |>
  mutate(`Data Type` = str_to_lower(`Data Type`)) |>
  kable(
    caption = "Data Types of Variables in Surveys Dataset on Rodents"
    ) |>
  kable_styling(font_size = 12) |>
  row_spec(
    row = 0,
    bold = TRUE
  ) 
```

**PE-4: I can use modern tools when carrying out my analysis.**

-   I can use functions which are not superseded or deprecated

```{r}
#| label: pe-4-1
# Lab 3 Question 8, Revised
teacher_evals_clean |>
  filter(if_any(.cols = everything(), .fns = ~ is.na(.x)))
```

-   I can connect a data wrangling pipeline into a `ggplot()`

```{r}
#| label: pe-4-2
# Lab 4 Question 7 Revised
# Success comment: Nice work pivoting and modifying the age variable!Nice work reordering your legend and your facets!!!Can you match my colors??? These are coming from a package and you will need to expand the color palette to get all 10 colors.
# Revised from midterm: I added dollar signs on the y-axis.

region_labels <- c(
  san_fran_counties            = "San Francisco Bay Area",
  inland_counties              = "Inland Empire",
  superior_counties            = "Superior California",
  north_coast_counties         = "North Coast",
  central_coast_counties       = "Central Coast",
  n_san_joaquin_counties       = "Northern San Joaquin Valley",
  s_san_joaquin_counties       = "Southern San Joaquin Valley",
  la_county                    = "Los Angeles County",
  orange_county                = "Orange County",
  san_diego_imperial_counties  = "San Diego–Imperial"
)
ca_childcare |>
  pivot_longer(cols = starts_with("mc_"),
             names_to = "age_group", names_prefix = "mc_",
             values_to = "weekly_price") |>
  mutate(age_group = str_to_title(age_group),
  county_region = fct_reorder2(.f = county_region,
                               .x = study_year,
                               .y = weekly_price)) |> 
  ggplot(mapping = aes(x = study_year, y = weekly_price, color = county_region)) +
  geom_point(alpha = 0.8, size = 0.6) +
  geom_smooth(method = "loess", linewidth = 0.5) + 
  facet_wrap(~ age_group) + 
  labs(
    title = "Weekly Median Price for Center-Based Childcare ($)",
    x = "Study Year",
    y = NULL,
    color = "California Region"
  ) + 
    scale_color_manual(
      breaks = names(region_labels),
      labels = region_labels,
      values = colorRampPalette(brewer.pal(8, "Accent"))(10)
  ) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    ) +
  scale_y_continuous(
    limits = c(100, 500),
    labels = label_currency()
  ) +
  theme_bw() +
  theme(
    aspect.ratio = 1,
    axis.text = element_text(size = 6),
    plot.title = element_text(size = 10),
    panel.border = element_rect(color = "black", fill = NA)
  )   
```

## Data Simulation & Statisical Models

**DSSM-1: I can simulate data from a *variety* of probability models.**

-   Example 1

```{r}
#| label: dsm-1-1
# Lab 10, Question 1 
randomBabies <- function(n_babies){
  baby_data <- tibble(baby = 1:n_babies,
         baby_chosen = sample(1:n_babies,
                              size = n_babies,
                              replace = F))
  baby_data |> 
    filter(baby == baby_chosen) |>
    nrow()

}

set.seed(123)

results <- map_int(.x = 1:10000,
                   .f = ~ randomBabies(n_babies = 4)
                  )
```

-   Example 2

```{r}
#| label: dsm-1-2
# Lab 10, Question 8/10
mycifun <- function (beta0, beta1, n) {
  # define slope and intercept parameters
  intercept = beta0
  slope = beta1
  # generate x vector
  x = runif(n, min = 0, max = 1)
  # generate noise `ep` vector
  ep = rnorm(n, mean = 0, sd = 1)
  # generate outcome from population model
  y = intercept + x*slope + ep
  # create an "observed data" dataframe with only the x and y vectors
  syn_data <- tibble(x,y)
  # fit a linear regression model to the simulated data
  model <- lm(y ~ x, data = syn_data)
  # check that slope is in CI
  tidy(model, conf.int = TRUE, conf.level = 0.95) |>
  filter(term == "x") |>
  select(estimate, conf.low, conf.high) |>
  mutate(cover = if_else(conf.low <= slope & conf.high >= slope, 1, 0))
}

set.seed(123)
ci_dat <- map(.x = 1:1000,
              .f = ~ mycifun(beta0 = 3, beta1 = 0.5, n = 100)
              )
```

**DSSM-2: I can conduct common statistical analyses in R.**

-   Example 1

```{r}
#| label: dsm-2-1
# Lab 4 Question 9, Revised
# Growing comment: Which variable should be x and y in lm()? This should match what you did in your plot!
# I corrected the x and y variables to be in the correct location in the model. 
reg_mod1 <- lm(mc_infant ~ mhi_2018, data = ca_childcare)
summary(reg_mod1)

```

-   Example 2

```{r}
#| label: dsm-2-2
# Lab 2 Question 17, Revised
# Success comment: Do you need to save an object here? All I want is to see the output...
summary(aov(weight ~ species, data = surveys))

```

-   Example 3

```{r}
#| label: dsm-2-3
# Lab 10, Question 5
model <- lm(y ~ x, data = syn_data)
summary(model)
```

## Revising My Thinking

<!-- How did you revise your thinking throughout the course? How did you revise your thinking on the code examples you have provided in your portfolio? -->

<!-- For the revisions included in your Portfolio, to help me understand the nature of your revisions, please denote somehow the feedback I provided you (e.g., boldface, italics, colored text) before your revisions. -->

I've revised my thinking with each assignment I completed by addressing and applying feedback I received. I have looked at every comment I have received on all of my assignments. I have revised all of my growing areas and worked to improve my success areas when possible. When I was unsure about a comment I received or if my revisions were sufficient, I sought further feedback through Office Hours and revision submissions. Although my code was not always satisfactory on my first attempt, I learned from the feedback I received, and brought this understanding to future assignments. In my portfolio, I revised my code both to make sure the learning targets were met and to address each growing or success comment. Finally, drafting this portfolio has provided me with the opportunity to take a second or even third look at my success and growing areas.

## Extending My Thinking

<!-- How did you extended your thinking throughout the course? How did you extend your thinking on the code examples you have provided in your portfolio? -->

To extend my thinking, I utilized my resources outside the classroom and challenged myself to find the most efficient methods. For example, when I wrote code that seemed inefficient, I would use ChatGPT as a tutor to guide me and help me understand other methods I could use to improve my code. I made an effort to use AI as a tool rather than a crutch. Additionally, when I wanted to do a novel task but did not know how to accomplish it, I would use Google to find a new function, a different theme, unique color palette, etc. For this portfolio, I addressed every success and growing comment I received to make my code as tidy and efficient as possible. I also used the Example Portfolio on the Course Website to reference what good code should look like.

## Peer Support & Collaboration

<!-- Include an image or a description of feedback you gave that you are proud of (either in a peer review or in Discord). -->

<!-- Include a description of how you grew as a collaborator through the weekly pair programming activities.   -->

I supported my peers and grew as a collaborator by providing helpful feedback on labs, asking questions on discord, and being a team player in pair programming activities.

Here is feedback I gave that is supportive and helpful. I addressed what they did well and as well as areas for improvement.

"Nice work on your lab! Your code is tidy, efficient, and easy to follow. I appreciate your use of named arguments which make you code especially easy to read. I only have a few minor tweaks that I would suggest making. I’d recommend reading over your code to just make sure white spaces are used before and after all (\~), (=), and (,). Also, for short and easily readable expressions like “beta1 \> conf.low & beta1 \< conf.high”, you could consider putting them on one line. That’s just a styling suggestion. I also noticed that you named a data frame “table”. This is a base R function, so I’d recommend naming it something else to avoid confusion. Again, my suggestions are all very minor because your code was great to start with! Good work!"

During the pair programming activities I grew as a collaborator by working with my partner to solve each question as a team. When it was my turn to type, I actively listened to my partner's code and respectfully suggested my input only when appropriate. When it was my partners turn to type I told my partner how I thought we should write the code. When neither my partner nor I could figure out a problem, we problem solved as a team or asked for help.
